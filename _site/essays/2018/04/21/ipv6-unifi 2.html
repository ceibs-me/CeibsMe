<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>在 UniFi 设备上使用 IPv6 的体验 | Livid</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="在 UniFi 设备上使用 IPv6 的体验" />
<meta name="author" content="Livid" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="最近对家里的网络做了一次升级，用上了 Native IPv6。这里分享一下过程和体验。" />
<meta property="og:description" content="最近对家里的网络做了一次升级，用上了 Native IPv6。这里分享一下过程和体验。" />
<link rel="canonical" href="http://localhost:4000/essays/2018/04/21/ipv6-unifi.html" />
<meta property="og:url" content="http://localhost:4000/essays/2018/04/21/ipv6-unifi.html" />
<meta property="og:site_name" content="Livid" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-21T00:00:00+08:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/essays/2018/04/21/ipv6-unifi.html","author":{"@type":"Person","name":"Livid"},"headline":"在 UniFi 设备上使用 IPv6 的体验","datePublished":"2018-04-21T00:00:00+08:00","dateModified":"2018-04-21T00:00:00+08:00","description":"最近对家里的网络做了一次升级，用上了 Native IPv6。这里分享一下过程和体验。","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/essays/2018/04/21/ipv6-unifi.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Livid" /><!--<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-3465543440750523",
      enable_page_level_ads: true
    });
  </script>-->
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Livid</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/">Livid</a><a class="page-link" href="/portfolio.html">Portfolio</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">在 UniFi 设备上使用 IPv6 的体验</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-04-21T00:00:00+08:00" itemprop="datePublished">Apr 21, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>最近对家里的网络做了一次升级，用上了 Native IPv6。这里分享一下过程和体验。</p>

<p>ISP 是南加州的某大型 cable Internet 公司，他们针对家庭宽带用户的服务目前已经完全支持 IPv6，因此只要家里的设备也支持并且配置正确的话，过程是很简单的。</p>

<p>我用的是全套的 UniFi 设备：</p>

<ul>
  <li>1 个 UniFi Security Gateway</li>
  <li>2 个 AC HD</li>
  <li>2 个 USW-8-150W 和 1 个 USW-16-150W</li>
  <li>1 个 AC In-Wall Pro</li>
</ul>

<p>UniFi Controller 是跑在一个 UniFi Cloud Key 上。</p>

<p><img src="https://i.v2ex.co/lD23fqmw.png" alt="" /></p>

<p>这里的一个关键是 UniFi Controller 软件最近的一次升级，具体可见这里：</p>

<p><a href="https://community.ubnt.com/t5/UniFi-Updates-Blog/UniFi-5-7-20-Stable-has-been-released/ba-p/2271529">UniFi 5.7.20 Stable Release Notes</a></p>

<p>在 5.7.20 版本中提供了对 IPv6 的支持，使得打开 IPv6 非常简单——只需要在 2 个地方点一下鼠标即可。</p>

<p>第一步是在 USG 的 WAN 设置中打开 IPv6，类似下面这样：</p>

<p><img src="https://i.v2ex.co/w3FYH53Y.png" alt="" /></p>

<p>第二步是在 UniFi Controller 的 Settings / Networks 里为 LAN 打开 IPv6。只要在 IPv6 Interface Type 那里选 Prefix Delegation 即可，其他什么都不用改：</p>

<p><img src="https://i.v2ex.co/ubd77h74.png" alt="" /></p>

<p>以上两步完成之后，网络里的设备就会获得 IPv6 的地址。比如 macOS 的话，可以把 WiFi 关掉又打开一次，就可以获得 IPv6 地址了。之后 macOS 在对外通信的时候，会优先使用 IPv6 网络。</p>

<p>这个时候如果访问 bgp.he.net 就可以看到自己的 IPv6 地址。这就是 IPv6 有意思的一点——在 Native IPv6 网络里，你的 IPv6 地址就是公网地址，如果没有任何防火墙规则的话，别人是可以直接连上你的 IPv6 地址的。也就是说，我上面那几步做完之后的效果就是，<strong>家里每一台支持 IPv6 的设备，都有了自己的公网地址</strong>。比如如果我在家里测试 V2EX 的开发版本，我可以直接把我本地机的 IPv6 地址加端口发给朋友，朋友就可以访问了。</p>

<p>这样听起来很不安全对不对？其实还好，因为 USG 默认防火墙规则的存在，使得虽然这些设备都有了公网地址，但是外面是无法连上这些设备的。</p>

<p>如果你希望把整个网络对外打开（<strong>不推荐这么做</strong>），那么最简单的方法就是在 UniFi Controller 的 Settings / Routing &amp; Firewall / Firewall / Rules IPv6 里为 WAN-IN 添加一条这样的规则：</p>

<p><img src="https://i.v2ex.co/269Vb0oo.png" alt="" /></p>

<p>当然，更安全的做法是，添加一些你确实需要的，同时又有足够安全考虑的规则。</p>

<p>比如你可以在 WAN-IN 里添加允许 ICMPv6，这样的效果是，外面可以 ping 所有的设备：</p>

<p><img src="https://i.v2ex.co/EQQxM3j0.png" alt="" /></p>

<p>这里推荐一个可以测试你的 IPv6 网络类型的网站：</p>

<p><a href="http://ipv6-test.com/">IPv6 Test</a></p>

<p>然后发现，任何的动态网站，如果要提供 IPv6 支持，有一些细节是需要改的。比如如果之前数据库里某张表有一个 ip 字段规划为了 varchar(15) 或者 int 的话，那么就是一个需要改的坑了。</p>

  </div>

  <div class="post-ads">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- livid.github.io page bottom -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3465543440750523"
         data-ad-slot="4912557007"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div><a class="u-url" href="/essays/2018/04/21/ipv6-unifi.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Livid</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Livid</li><li><a class="u-email" href="mailto:livid@v2ex.com">livid@v2ex.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://twitter.com/livid"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">livid</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>rss</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Beautifully Advance
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
